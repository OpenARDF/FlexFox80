<!DOCTYPE html>
<meta name="viewport" content="width=device-width, initial-scale=1">

<head>
    <title>Radio Mode</title>
    <style type="text/css">
        .button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
        }

        .incbutton {
            background-color: blue;
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
        }

        .decbutton {
            background-color: blue;
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
        }

        input[type="text"]:value {
            -webkit-text-font-weight: bold;
        }

        ::placeholder {
            color: red;
            opacity: 1;
            /* Firefox */
        }

        :-ms-input-placeholder {
            /* Internet Explorer 10-11 */
            color: red;
        }

        ::-ms-input-placeholder {
            /* Microsoft Edge */
            color: red;
        }

        ::-webkit-input-placeholder {
            /* Chrome/Opera/Safari */
            color: red;
        }

        ::-moz-placeholder {
            /* Firefox 19+ */
            color: red;
        }

        :-moz-placeholder {
            /* Firefox 18- */
            color: red;
        }

        iframe,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        p,
        blockquote,
        pre,
        a,
        abbr,
        acronym,
        address,
        big,
        cite,
        code,
        del,
        dfn,
        em,
        img,
        ins,
        kbd,
        q,
        s,
        samp,
        small,
        strike,
        strong,
        sub,
        sup,
        tt,
        var,
        b,
        u,
        i,
        center,
        dl,
        dt,
        dd,
        ol,
        ul,
        li,
        fieldset,
        form,
        label,
        legend,
        table,
        caption,
        tbody,
        tfoot,
        thead,
        tr,
        th,
        td,
        article,
        aside,
        canvas,
        details,
        embed,
        figure,
        figcaption,
        footer,
        header,
        hgroup,
        menu,
        nav,
        output,
        ruby,
        section,
        summary,
        time,
        mark,
        audio,
        video {
            margin: 0;
            /*      padding: 0; */
            /*      border: 0; */
            font-size: 100%;
            font: inherit;
            vertical-align: baseline;
        }

        #overlay {
            position: fixed;
            display: none;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2;
            cursor: pointer;
        }

        #overlayText {
            position: absolute;
            top: 50%;
            left: 50%;
            font-size: 50px;
            font-family: verdana;
            color: white;
            transform: translate(-50%, -50%);
            -ms-transform: translate(-50%, -50%);
        }

    </style>
</head>

<body onload="javascript:start();">
    <script>
        var g_timer = 0;
        var g_timeUpdateTimer = 0;
        var g_homeTimer = 0;
        var g_timedOut = false;

        var g_lastFreqTime = 0;
        var g_webSocketTxFreqTimer = 0;

        var g_numberOfOpenWebSockets = 0;
        var g_stillConnected = 0;
        var g_stillDisconnected = 60;
        var g_lastPacketTime = 0;
        var g_webSocketTxTimer = 0;
        var g_lastSocketTxMessage;
        var g_transmitterTimeMs = 0;
        var g_websock = null;
        var g_timesync_rcvd = 0;
        var g_webSocketAliveTimer = 0;

        var g_radio_initialized = false;

        ///////////////////////////////
        // Settings
        var g_selectedTxType;

        var g_eventTableData = [{
            power: "Power",
            modulation: "CW Speed",
            freq: "Frequency",
            pattern: "Text",
            callsign: "ID",
            sleep: "Master",
            codespeed: ""
        }]; /* Event data to display in a table header */

        var g_powerLevels_80m = ["0", "10", "100", "200", "300", "400", "500", "600", "800", "1000", "1500", "2000", "2500", "3000", "4000", "5000"];
        var g_morseSpeed = ["5", "8", "12", "15", "18", "20"];

        var g_powerLevel = g_powerLevels_80m[0];
        var g_cwSpeed = "8";
        var g_freq1FrequencyHz = 3600000;
        var g_userText1 = "73";
        var g_userText2 = "73";
        var g_userText3 = "73";
        var g_userText4 = "73";
        var g_userText5 = "73";

        ///////////////////////////////

        function setCookie(exdays, cname, value) {
            const d = new Date();
            d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
            let expires = "expires=" + d.toUTCString();
            var tag = cname + "=";
            if (typeof value === 'string' || value instanceof String) {
                value = value.toUpperCase();
            }
            document.cookie = tag + value + ";" + expires + ";path=/";
        }

        function getCookies() {
            let success = false;
            let power = "power=";
            let freq = "freq=";
            let wpm = "wpm=";
            let ut1 = "ut1=";
            let ut2 = "ut2=";
            let ut3 = "ut3=";
            let ut4 = "ut4=";
            let ut5 = "ut5=";

            let decodedCookie = decodeURIComponent(document.cookie);
            let ca = decodedCookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(power) == 0) {
                    g_powerLevel = c.substring(power.length, c.length);
                    success = true;
                }
            }

            if (!success) {
                setCookie(2.365, "power", g_powerLevel);
            }
            success = false;

            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(freq) == 0) {
                    g_freq1FrequencyHz = Number(c.substring(freq.length, c.length));
                    success = true;
                }
            }
            if (!success) {
                setCookie(2.365, "freq", g_freq1FrequencyHz);
            }
            success = false;

            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(wpm) == 0) {
                    g_cwSpeed = c.substring(wpm.length, c.length);
                    success = true;
                }
            }

            if (!success) {
                setCookie(2.365, "wpm", g_cwSpeed);
            }
            success = false;

            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(ut1) == 0) {
                    g_userText1 = c.substring(ut1.length, c.length);
                    success = true;
                }
            }

            if (!success) {
                setCookie(2.365, "ut1", g_userText1);
            }
            success = false;

            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(ut2) == 0) {
                    g_userText2 = c.substring(ut2.length, c.length);
                    success = true;
                }
            }

            if (!success) {
                setCookie(2.365, "ut2", g_userText2);
            }
            success = false;

            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(ut3) == 0) {
                    g_userText3 = c.substring(ut3.length, c.length);
                    success = true;
                }
            }

            if (!success) {
                setCookie(2.365, "ut3", g_userText3);
            }
            success = false;

            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(ut4) == 0) {
                    g_userText4 = c.substring(ut4.length, c.length);
                    success = true;
                }
            }

            if (!success) {
                setCookie(2.365, "ut4", g_userText4);
            }
            success = false;

            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(ut5) == 0) {
                    g_userText5 = c.substring(ut5.length, c.length);
                    success = true;
                }
            }

            if (!success) {
                setCookie(2.365, "ut5", g_userText5);
            }
        }

        function displayEvents(erase) {
            var eventNum = g_eventTableData.length;
            var eventTable = document.getElementById("eventTable");
            var tableRows = eventTable.getElementsByTagName('tr');
            var rowCount = tableRows.length;

            console.log("rowCount = ", rowCount);

            if (erase == true) {
                for (var x = rowCount - 1; x >= 0; x--) {
                    eventTable.removeChild(tableRows[x]);
                }

                eventTable.appendChild(eventRow(g_eventTableData[0], true));

                for (var i = 1; i < eventNum; i++) {
                    eventTable.appendChild(eventRow(g_eventTableData[i], false));
                }
            } else {
                console.log("Refreshing table cells");
                for (var i = 1, row; row = eventTable.rows[i]; i++) {
                    var rowData = g_eventTableData[i];
                    for (var j = 0, col; col = row.cells[j]; j++) {
                        col = rowData[j];
                    }
                }
            }

            var txt = document.getElementById("user1Text");
            txt.value = g_userText1;
            txt = document.getElementById("user2Text");
            txt.value = g_userText2;
            txt = document.getElementById("user3Text");
            txt.value = g_userText3;
            txt = document.getElementById("user4Text");
            txt.value = g_userText4;
            txt = document.getElementById("user5Text");
            txt.value = g_userText5;
        }

        function keyDownAction() {
            var btn = document.getElementById("keyButton");

            var x = document.getElementById("errorreport");
            if (x != null) x.style.display = "none";

            x = document.getElementById("statusreport");
            if (x != null) x.style.display = "none";

            btn.setAttribute("style", "background-color: #FF0000;");
            sendKeyDown();
        }

        function keyUpAction() {
            var btn = document.getElementById("keyButton");

            var x = document.getElementById("errorreport");
            if (x != null) x.style.display = "none";

            x = document.getElementById("statusreport");
            if (x != null) x.style.display = "none";

            btn.setAttribute("style", "background-color: #40A1FF;");
            btn.value = "Key"
            sendKeyUp();
        }

        function eventRow(rowData, isHeader) {
            var row = document.createElement("tr");
            var cellText;
            var cell0;

            console.log("rowData = ", rowData);

            if (isHeader == true) {
                row.setAttribute("style", "font-family:verdana; font-size:15px; color:Black; font-weight:bold; text-align:center;");

                // create cells in row
                cell0 = document.createElement("td");
                cell0.setAttribute("border", "1px solid black");
                cellText = document.createTextNode("Transmitter");
                cell0.appendChild(cellText);
                row.appendChild(cell0);

                cell0 = document.createElement("td");
                cellText = document.createTextNode("Power (mW)");
                cell0.setAttribute("border", "1px solid black");
                cell0.appendChild(cellText);
                row.appendChild(cell0);

                cell0 = document.createElement("td");
                cellText = document.createTextNode("WPM");
                cell0.setAttribute("border", "1px solid black");
                cell0.appendChild(cellText);
                row.appendChild(cell0);

                cell0 = document.createElement("td");
                cellText = document.createTextNode("Frequency");
                cell0.setAttribute("border", "1px solid black");
                cell0.appendChild(cellText);
                row.appendChild(cell0);

                cell0 = document.createElement("td");
                cellText = document.createTextNode("Type Here");
                cell0.setAttribute("border", "1px solid black");
                cell0.appendChild(cellText);
                row.appendChild(cell0);
            } else {

                // create cells in row
                var btn = document.createElement('input');
                var entry = rowData.name;
                btn.type = "button";
                btn.className = "button";
                btn.id = "keyButton";
                btn.value = "Key";
                btn.onmouseup = (function(entry) {
                    return function() {
                        keyUpAction();
                    }
                })(entry);
                btn.onmouseout = (function(entry) {
                    return function() {
                        keyUpAction();
                    }
                })(entry);
                btn.onmousedown = (function(entry) {
                    return function() {
                        keyDownAction();
                    }
                })(entry);

                cell0 = document.createElement("td");
                cell0.setAttribute("border", "1px solid black");
                cell0.appendChild(btn);
                row.appendChild(cell0);


                // Power Level mW
                cell0 = document.createElement("td");
                cell0.setAttribute("border", "1px solid black");

                var sel, option, i, il;
                sel = document.createElement('select'),
                    option,
                    i = 0,
                    il = g_powerLevels_80m.length;

                sel.setAttribute("onchange", "pwrClick()");
                sel.setAttribute("id", "pwrSelect");
                sel.setAttribute("style", "font-family:verdana; font-size:15px; color:blue; font-weight:bold;");

                for (; i < il; i += 1) {
                    option = document.createElement('option');
                    option.setAttribute('value', g_powerLevels_80m[i]);
                    option.appendChild(document.createTextNode(g_powerLevels_80m[i]));
                    if (g_powerLevels_80m[i] == g_powerLevel) {
                        option.setAttribute("selected", "true");
                    }
                    console.log("Power option:", g_powerLevels_80m[i]);

                    sel.appendChild(option);
                }


                cell0.appendChild(sel);
                row.appendChild(cell0);


                // Morse Speed
                cell0 = document.createElement("td");
                cell0.setAttribute("border", "1px solid black");

                sel = document.createElement('select'),
                    option,
                    i = 0,
                    il = g_morseSpeed.length;

                sel.setAttribute("onchange", "sendCodeSpeed()");
                sel.setAttribute("id", "cwSpeedSelect");
                sel.setAttribute("style", "font-family:verdana; font-size:15px; color:blue; font-weight:bold;");

                for (; i < il; i += 1) {
                    option = document.createElement('option');
                    option.setAttribute('value', g_morseSpeed[i]);
                    option.appendChild(document.createTextNode(g_morseSpeed[i]));
                    if (g_morseSpeed[i] == g_cwSpeed) {
                        option.setAttribute("selected", "true");
                    }

                    sel.appendChild(option);
                    console.log("CW Speed:", g_morseSpeed[i]);
                }

                cell0.appendChild(sel);
                row.appendChild(cell0);

                // Set Frequency
                cell0 = document.createElement("td");
                var b = document.createElement('input');
                b.setAttribute("type", "button");
                b.setAttribute("id", "frequencyButton");
                b.setAttribute("class", "incbutton");
                b.setAttribute("value", freqDotFormat(g_freq1FrequencyHz));
                b.setAttribute("onclick", "toggleFreqSettings();");
                cell0.appendChild(b);

                row.appendChild(cell0);

                // Pattern Text
                cell0 = document.createElement("td");
                console.log("Pattern:", "PARIS");
                cell0.setAttribute("border", "1px solid black");
                cell0.setAttribute("id", "patternSet");
                var t = document.createElement("input");
                t.setAttribute("type", "text");
                t.setAttribute("id", "patternText");
                t.setAttribute("style", "font-family:verdana; font-size:15px; font-weight:bold; text-align:center");
                t.setAttribute("placeholder", "_");
                t.setAttribute("contenteditable", "true");
                t.setAttribute("value", "");

                t.onkeyup = (function(entry) {
                    return function(entry) {
                        sendCharAction(entry);
                    }
                })(entry);

                t.onkeydown = (function(entry) {
                    return function(entry) {
                        clearCharsAction(entry);
                    }
                })(entry);

                cell0.appendChild(t);
                row.appendChild(cell0);
            }

            return row;
        }

        g_timeUpdateTimer = setTimeout(function() {
            updateDisplayedLocalTime();

            if (g_stillConnected) {
                g_stillConnected--;
                if (g_stillConnected == 0) {
                    setOverlay("Disconnected");
                    console.log("g_stillConnected timeout!!");
                    g_timedOut = true;
                    g_stillDisconnected = 200;
                }
            } else {
                if (g_stillDisconnected) {
                    g_stillDisconnected--;
                    if (g_stillDisconnected == 0) {
                        g_stillDisconnected = 200;
                        //                webSocketStart();
                        //                console.log("Disconnected! Started new websocket");
                        console.log("Disconnected!");
                    }
                }
            }
        }, 100);

        function webSocketStart() {
            var websocketcreated = true;
            var host = String(window.location.hostname);

            console.log("Host: " + host);

            if (host.length > 0) {
                if (g_websock != null) // socket already exists
                {
                    g_websock.close();
                    g_websock = null;
                }

                try {
                    g_numberOfOpenWebSockets++;
                    g_websock = new WebSocket("ws://" + window.location.hostname + ":81/");
                } catch (err) {
                    document.getElementById("xmtrTime").innerHTML = "Disconnected";
                    console.log("Unable to create web socket");
                    websocketcreated = false;
                    setOverlay("Disconnected\nNo Socket");
                    if (g_numberOfOpenWebSockets) g_numberOfOpenWebSockets--;
                }
            } else {
                document.getElementById("xmtrTime").innerHTML = "Disconnected\nNo Socket Host";
                console.log("No websocket host available.");
                websocketcreated = false;
                g_websock = null;
                setOverlay("Disconnected");
            }

            if (websocketcreated == true) {
                document.getElementById("xmtrTime").innerHTML = "Connected";

                g_websock.onopen = function(evt) {
                    console.log("websock open");
                    websocketcreated = true;
                    g_stillConnected = Math.max(200, g_stillConnected);

                    setTimeout(function() {
                        sendSocketAlive();
                    }, 250);

                    setTimeout(function() {
                        sendToSocket("CLEAR");
                    }, 500);

                    setTimeout(function() {
                        sendToSocket("SSID");
                    }, 750);

                    setTimeout(function() {
                        sendToSocket("MAC");
                    }, 1000);

                    setTimeout(function() {
                        sendToSocket("SW_VERSIONS");
                    }, 1250);

                    if (!g_radio_initialized) {
                        g_radio_initialized = true;
                        setTimeout(function() {
                            sendCookieValuesToRadio();
                        }, 1500);
                    }
                }

                g_websock.onclose = function(evt) {
                    if (g_numberOfOpenWebSockets) g_numberOfOpenWebSockets--;

                    if (g_numberOfOpenWebSockets == 0) {
                        console.log("all websocks closed");
                        if (websocketcreated == true) { // handle test case where server refuses websocket
                            setOverlay("Disconnected");
                        }
                        websocketcreated = false;
                        g_websock = null;
                        g_stillConnected = 0;
                    } else {
                        console.log("old websock closed");
                    }
                };

                g_websock.onerror = function(evt) {
                    console.log("Websock error: " + evt);
                };

                g_websock.onmessage = function(evt) {
                    var str = evt.data;
                    var arr = str.split(",");

                    g_stillConnected = Math.max(50, g_stillConnected);
                    if (g_timedOut) {
                        g_timedOut = false;
                    }

                    setOverlay(null);

                    switch (arr[0]) {
                        case "STATUS":
                            {
                                var text;
                                var sc = parseInt(arr[1], 10);

                                switch (sc) {

                                    case 0x00: // STATUS_CODE_IDLE = 0x00
                                    case 0x01: // STATUS_CODE_REPORT_IDLE = 0x01;
                                        {
                                            text = "";
                                        }
                                        break;

                                    case 0xE9: // STATUS_CODE_NO_ANT_ATTACHED = 0xE9
                                        {
                                            text = "No antennas attached";
                                        }
                                        break;

                                    case 0xEA: // STATUS_CODE_2M_ANT_ATTACHED = 0xEA
                                        {
                                            text = "2m antenna attached";
                                        }
                                        break;

                                    case 0xEB: // STATUS_CODE_80M_ANT_ATTACHED = 0xEB
                                        {
                                            text = "80m antenna attached";
                                        }
                                        break;

                                    case 0xEC: // STATUS_CODE_RECEIVING_EVENT_DATA = 0xEC
                                        {
                                            text = "Transmitter ready to receive event data";
                                        }
                                        break;

                                    case 0xED: // STATUS_CODE_RETURNED_FROM_SLEEP = 0xED
                                        {
                                            text = "Transmitter returned from sleep";
                                        }
                                        break;

                                    case 0xEE: // STATUS_CODE_BEGINNING_XMSN_THIS_CYCLE = 0xEE
                                        {
                                            text = "Transmitter will transmit this cycle";
                                        }
                                        break;

                                    case 0xEF: // STATUS_CODE_SENDING_ID = 0xEF
                                        {
                                            text = "Transmitter sending ID";
                                        }
                                        break;

                                    case 0xFB: // STATUS_CODE_EVENT_NEVER_ENDS = 0xFB
                                        {
                                            text = "Event never ends";
                                        }
                                        break;

                                    case 0xFC: // STATUS_CODE_EVENT_FINISHED = 0xFC
                                        {
                                            text = "Event has completed";
                                        }
                                        break;

                                    case 0xFD: // STATUS_CODE_EVENT_STARTED_NOW_TRANSMITTING = 0xFD
                                        {
                                            text = "Transmitter on the air";
                                        }
                                        break;

                                    case 0xFE: // STATUS_CODE_EVENT_STARTED_WAITING_FOR_TIME_SLOT = 0xFE
                                        {
                                            text = "Transmitter waiting for time slot";
                                        }
                                        break;

                                    case 0xFF: // STATUS_CODE_WAITING_FOR_EVENT_START = 0xFF
                                        {
                                            text = "Transmitter waiting for event start";
                                        }
                                        break;

                                    default:
                                        {
                                            text = "Undefined status - update file system";
                                        }
                                        break;
                                }

                                if (text.length) {
                                    var e = "State: " + text;
                                    var elem = document.getElementById("statusreport");
                                    if (elem != null) {
                                        elem.innerHTML = e;
                                        elem.setAttribute("style", "font-family:verdana; font-size:25px; color:Black; font-weight:bold; text-align:center;");
                                    }
                                } else {
                                    var x = document.getElementById("statusreport");
                                    if (x != null) x.style.display = "none";

                                }

                                console.log("Status Code:" + arr[1]);
                            }
                            break;

                        case "ERR_CODE":
                            {
                                var text;
                                var ec = parseInt(arr[1], 10);

                                switch (ec) {
                                    case 0x00: //	ERROR_CODE_NO_ERROR = 0x00
                                        {
                                            text = "No error";
                                        }
                                        break;

                                    case 0xC7: // ERROR_CODE_EVENT_STATION_ID_ERROR = 0xC7
                                        {
                                            text = "Station callsign error";
                                        }
                                        break;

                                    case 0xC8: // ERROR_CODE_EVENT_PATTERN_CODE_SPEED_NOT_SPECIFIED = 0xC8
                                        {
                                            text = "Pattern code speed not specified";
                                        }
                                        break;

                                    case 0xC9: // ERROR_CODE_EVENT_PATTERN_NOT_SPECIFIED = 0xC9
                                        {
                                            text = "Morse code pattern not specified";
                                        }
                                        break;

                                    case 0xCA: // ERROR_CODE_EVENT_TIMING_ERROR = 0xCA
                                        {
                                            text = "Timing parameters invalid";
                                        }
                                        break;

                                    case 0xCB: // ERROR_CODE_EVENT_MISSING_TRANSMIT_DURATION
                                        {
                                            text = "No transmit duration specified for the transmitter's role";
                                        }
                                        break;

                                    case 0xCC: // ERROR_CODE_EVENT_MISSING_START_TIME
                                        {
                                            text = "No start time specified for the event";
                                        }
                                        break;

                                    case 0xCD: // ERROR_CODE_EVENT_NOT_CONFIGURED
                                        {
                                            text = "Transmitter not fully configured for the event";
                                        }
                                        break;

                                    case 0xCE: // ERROR_CODE_ILLEGAL_COMMAND_RCVD = 0xCE
                                        {
                                            text = "Illegal command";
                                        }
                                        break;

                                    case 0xCF: // ERROR_CODE_SW_LOGIC_ERROR = 0xCF
                                        {
                                            text = "Software logic error";
                                        }
                                        break;

                                    case 0xD0: // ERROR_CODE_EVENT_ENDED_IN_PAST
                                        {
                                            text = "Event ended in the past";
                                        }
                                        break;

                                    case 0xD1: // ERROR_CODE_ATMEGA_NOT_RESPONDING
                                        {
                                            text = "ATMEGA not responding";
                                        }
                                        break;

                                    case 0xF5: // ERROR_CODE_POWER_LEVEL_NOT_SUPPORTED = 0xF5
                                        {
                                            text = "Transmit power level not supported";
                                        }
                                        break;

                                    case 0xF6: // ERROR_CODE_NO_ANTENNA_PREVENTS_POWER_SETTING = 0xF6
                                        {
                                            text = "Missing antenna prevents transmissions";
                                        }
                                        break;

                                    case 0xF7: // ERROR_CODE_NO_ANTENNA_FOR_BAND = 0xF7
                                        {
                                            text = "No antenna connected for that band";
                                        }
                                        break;

                                        //	ERROR_CODE_WD_TIMEOUT = 0xF8,
                                    case 0xF8:
                                        {
                                            text = "Watchdog timeout";
                                        }
                                        break;

                                        //	ERROR_CODE_SUPPLY_VOLTAGE_ERROR = 0xF9
                                    case 0xF9:
                                        {
                                            text = "Supply voltage out of range";
                                        }
                                        break;

                                        //	ERROR_CODE_BUCK_REG_OUTOFSPEC = 0xFA
                                    case 0xFA:
                                        {
                                            text = "Power amplifier voltage out of range";
                                        }
                                        break;

                                        //	ERROR_CODE_CLKGEN_NONRESPONSIVE = 0xFB
                                    case 0xFB:
                                        {
                                            text = "Signal generator not responding";
                                        }
                                        break;

                                        //	ERROR_CODE_RTC_NONRESPONSIVE = 0xFC
                                    case 0xFC:
                                        {
                                            text = "Real-time clock not responding";
                                        }
                                        break;

                                        //	ERROR_CODE_DAC3_NONRESPONSIVE = 0xFD
                                    case 0xFD:
                                        {
                                            text = "DAC3 not responding";
                                        }
                                        break;

                                        //	ERROR_CODE_DAC2_NONRESPONSIVE = 0xFE
                                    case 0xFE:
                                        {
                                            text = "DAC2 not responding";
                                        }
                                        break;

                                    case 0xFF: //	ERROR_CODE_DAC1_NONRESPONSIVE = 0xFF
                                        {
                                            text = "DAC1 not responding";
                                        }
                                        break;

                                    default:
                                        {
                                            text = "Undefined error - update file system"
                                        }
                                        break;
                                }

                                var e = "Error: " + text;
                                var elem = document.getElementById("errorreport");
                                if (elem != null) {
                                    elem.innerHTML = e;
                                    elem.setAttribute("style", "font-family:verdana; font-size:25px; color:Red; font-weight:bold; text-align:center;");
                                }
                                console.log("Error Code:" + arr[1]);
                            }
                            break;


                        case "FILE_VERSION":
                            {
                                //                    document.getElementById("eventFileVers").innerHTML = arr[1];
                                console.log("Event Version: ", arr[1]);
                            }
                            break;

                        case "SW_VERSIONS":
                            {
                                if (typeof arr[1] == 'undefined') arr[1] = '?';
                                if (typeof arr[2] == 'undefined') arr[2] = '?';

                                var v1 = document.getElementById("wifiVersion");
                                var v2 = document.getElementById("ATMEGAVersion");
                                console.log("Tx SW Versions: ", arr[1], arr[2]);

                                if (v1 != null) {
                                    v1.innerHTML = "WiFi Module SW Version: " + arr[1];
                                }

                                if (v2 != null) {
                                    v2.innerHTML = "ATMEGA SW Version: " + arr[2];
                                }
                            }
                            break;

                        case "SYNC":
                            {
                                g_transmitterTimeMs = 1000 * arr[1];
                                //                                console.log("Tx time rcvd:", g_transmitterTimeMs);
                                var txd = new Date(g_transmitterTimeMs);
                                document.getElementById("xmtrTime").innerHTML = "TX: " + txd;
                                updateDisplayedLocalTime()
                            }
                            break;

                        case "CLONE":
                            {
                                document.getElementById("cloneText").value = arr[1];
                            }
                            break;

                        case "VERS":
                            {
                                document.getElementById("version").innerHTML = arr[1];
                            }
                            break;

                        case "MAC":
                            {
                                var t = "MAC: " + arr[1];
                                document.getElementById("macAddress").innerHTML = t;
                                //                                console.log(t);
                            }
                            break;

                        case "BAT":
                            {
                                var t = "Battery: " + arr[1];
                                document.getElementById("batteryLevel").innerHTML = t;
                                console.log(t);
                            }
                            break;

                        case "TEMP":
                            {
                                var t = "Temp: " + arr[1];
                                document.getElementById("temperature").innerHTML = t;
                                //              console.log(t);
                            }
                            break;

                        case "SSID":
                            {
                                var t = arr[1] + ": QRP Transmitter";
                                document.getElementById("mainHeading").innerHTML = t;
                                console.log(t);
                            }
                            break;

                        case "CALLSIGN":
                            {
                                var c = document.getElementById("callText");
                                if (c != null) {
                                    c.value = arr[1];
                                }
                            }
                            break;

                        case "FREQ":
                            {
                                g_freq1FrequencyHz = Number(arr[1]);
                                console.log("Freq: ", arr[1]);
                            }
                            break;

                        case "POWER":
                            {
                                var mw = arr[1];

                                console.log("tx power: ", arr[1]);
                                var pe = document.getElementById("pwrSelect");

                                if (pe != null) {
                                    pe.value = arr[1];
                                }
                            }
                            break;

                        case "SAVED_EVENT":
                            {
                                var btext = "CLEAR";
                                console.log(btext);
                                sendToSocket(btext);
                            }
                            break;

                        default:
                            console.log("Unrecognized message: ", str);
                            break;
                    }
                }
            }
        }

        function start() {
            console.log("At start of start() function!");
            g_stillConnected = 200;
            getCookies();
            webSocketStart();

            g_selectedTxType = "";
            hideFreqSettings();

            console.log("Freq: ", g_freq1FrequencyHz);

            hideFreqSet1();
            updateTextFormatting();
            g_eventTableData = [{}];

            var eventLine = {};
            g_eventTableData.push(eventLine);
            displayEvents(true);

            console.log("At end of start() function!");
        }

        function clamp(min, num, max) {
            return num <= min ? min : num >= max ? max : num;
        }

        function sendSocketAlive() {
            if (g_webSocketAliveTimer != 0) {
                clearInterval(g_webSocketAliveTimer);
                g_webSocketTxTimer = 0;
            }

            sendToSocket("!&");
            console.log("!&");

            g_webSocketAliveTimer = setTimeout(function() {
                sendSocketAlive();
            }, 2000);
        }

        function sendToSocket(msg) {
            var now = Date.now();
            var dif = now - g_lastPacketTime;

            if (g_webSocketTxTimer != 0) {
                clearInterval(g_webSocketTxTimer);
                g_webSocketTxTimer = 0;
            }

            if ((g_websock == null) || (g_websock.readyState != g_websock.OPEN)) // wait 5 seconds and try again
            {
                if (g_websock != null) {
                    console.log("Socket not ready. Command delayed.", g_websock, g_websock.readyState);
                } else {
                    console.log("Socket null. Restarting.");
                    webSocketStart();
                }

                g_webSocketTxTimer = setTimeout(function() {
                    sendToSocket(msg);
                }, 5000);

            } else {
                if (dif > 50) {
                    g_websock.send(msg);
                    g_lastPacketTime = now;
                    g_lastSocketTxMessage = msg;
                    if (msg != "!&") console.log("=> ", msg);
                } else {
                    console.log("Commands too rapid. Delaying send.");
                    setTimeout(function() {
                        sendToSocket(msg);
                    }, 250);
                }
            }
        }

        function syncClock() {
            var d = Date();

            if (g_timeUpdateTimer != 0) {
                clearTimeout(g_timeUpdateTimer);
                g_timeUpdateTimer = 0;
            }

            // Sync to seconds transition
            n = Date();
            while (d == n) {
                //               console.log("Syncing...", d, n);
                n = Date();
            };

            d = new Date();

            var btext = d.toISOString();
            btext = "SYNC," + btext;
            console.log(btext);
            sendToSocket(btext);
            updateDisplayedLocalTime();

            g_timeUpdateTimer = setTimeout(function() {
                if (g_stillConnected) {
                    updateDisplayedLocalTime();
                    if (g_stillConnected) {
                        g_stillConnected--;
                        if (g_stillConnected == 0) {
                            console.log("g_stillConnected timeout!");
                            setOverlay("Disconnected");
                            g_timedOut = true;
                        }
                    }
                }
            }, 100);
        }

        function sendKeyDown() {
            var btext = "KEY_DOWN";
            sendToSocket(btext);
        }

        function sendKeyUp() {
            var btext = "KEY_UP";
            sendToSocket(btext);
        }

        function sendCharAction(e) {
            var needsEscape = /^[,!?$\\]*$/;
            var text = String(e.key);

            if (text.length < 2) {
                if (text.length > 0) {
                    console.log("up: ");
                    console.log(e);
                    if (text.match(needsEscape)) {
                        text = "\\" + text;
                    }
                    var btext = "PASS,$KEY," + text + ";";
                    sendToSocket(btext);
                }
            } else if (text == 'Backspace') {
                var btext = "PASS,$KEY,\\\\b;";
                sendToSocket(btext);
            }
        }

        function clearCharsAction(e) {
            if (e.key == 'Enter') {
                let d = document.getElementById("patternText");
                if (d) {
                    d.value = "";
                }
            }

        }

        function sendPower() {
            var p = document.getElementById("pwrSelect");

            if (p) {
                var power = p.value;
                var msgText = "POWER,0," + power;
                sendToSocket(msgText);
                g_powerLevel = power;
                setCookie(2 * 356, "power", g_powerLevel);
            }
        }


        function sendCodeSpeed() {
            var s = document.getElementById("cwSpeedSelect");

            if (s) {
                var speed = s.value;
                var msgText = "SPEED," + speed;
                sendToSocket(msgText);
                g_cwSpeed = speed;
                setCookie(2 * 356, "wpm", g_cwSpeed);
            }
        }


        function sendFreq(freq) {
            var now = Date.now();
            var dif = now - g_lastFreqTime;

            if (g_webSocketTxFreqTimer != 0) {
                clearInterval(g_webSocketTxFreqTimer);
                g_webSocketTxFreqTimer = 0;
            }

            if (dif > 500) {
                var msgText = "FREQ,0," + freq;
                sendToSocket(msgText);
                g_lastFreqTime = now;
                g_freq1FrequencyHz = freq;
                setCookie(2 * 356, "freq", String(g_freq1FrequencyHz));
            } else {
                console.log("Freq too fast. Delaying send.");
                g_webSocketTxFreqTimer = setTimeout(function() {
                    sendFreq(freq);
                }, 300);
            }

        }

        function pwrClick() {
            var x = document.getElementById("errorreport");
            if (x != null) x.style.display = "none";

            x = document.getElementById("statusreport");
            if (x != null) x.style.display = "none";

            sendPower();
        }

        function setOverlay(msgTxt) {
            if (msgTxt != null) {
                document.getElementById("overlayText").innerHTML = msgTxt;
                document.getElementById("overlay").style.display = "block";
            } else {
                document.getElementById("overlay").style.display = "none";
            }
        }

        // Takes the time string argument and forces it to be UTC with seconds removed, 
        // then applies any local timezone offset to obtain local time. Returns ISO string of converted time.
        function forceValueToLocalTime(val) {
            var sub = val.slice(0, 16); // remove seconds
            sub = sub + "Z"; // for to UTC
            var d = new Date(sub);
            var tzoffset = (new Date()).getTimezoneOffset() * 60000; //offset in milliseconds
            var t = d.getTime() + tzoffset;
            var localISOTime = "";
            if (t > 0) {
                localISOTime = (new Date(t)).toISOString();
            }

            return localISOTime;
        }

        // Force the argument to be interpreted as UTC then use it to create a Date object
        function utcTimeToLocalTime(val) {
            var z = val.indexOf("Z");

            if (z < 0) {
                val = val + "Z";
            }

            var d = new Date(val);
            return d;
        }

        // Converts the date value argument to UTC, removes seconds, and then returns as a UTC string without seconds
        // An error will result in the current time being returned as a UTC string without seconds
        function localTimeToUTC(val) {
            try {
                var d = new Date(val).toISOString();
                var sub = d.slice(0, 16); // remove seconds
                sub = sub + "Z"; // for UTC      
            } catch (err) {
                var d = new Date().toISOString();
                var sub = d.slice(0, 16); // remove seconds
                sub = sub + "Z"; // for UTC      
            }

            return sub;
        }

        function validateTimeStructure(str) {
            try {
                var d = new Date(str).toISOString();
                return true;
            } catch (err) {
                return false;
            }
        }

        function updateDisplayedLocalTime() {
            var d = Date();
            var el = document.getElementById("currentTime");
            if (el != null) {
                el.innerHTML = "OS: " + d;
                updateTextFormatting();
            }
        }

        function epochToLocalDateTimeFormat(epoch_ms) {
            var local = new Date(epoch_ms);

            var mon = ("0" + (local.getMonth() + 1)).slice(-2);
            var day = ("0" + local.getDate()).slice(-2);
            var hour = ("0" + local.getHours()).slice(-2);
            var min = ("0" + local.getMinutes()).slice(-2);
            var timeStr = local.getFullYear() + "-" + mon + "-" + day + "T" + hour + ":" + min;

            return timeStr;
        }


        function hasNumber(myString) {
            return /\d/.test(myString);
        }

        function hasAlpha(myString) {
            return /\D/.test(myString);
        }

        function hasAlphaNumPunc(myString) {
            return /^[-0-9A-Za-z:;,$]+$/.test(myString);
        }

        function updateTextFormatting() {
            var callsignText = document.getElementById("callText");
            var string = "";

            if (callsignText != null) {
                string = String(callsignText.value);
                if (hasNumber(string) && hasAlpha(string) && (string.length > 2)) {
                    callsignText.style.color = "blue";
                } else {
                    callsignText.style.color = "red";
                }
            }

            var commandText = document.getElementById("commandText");

            if (commandText != null) {
                string = String(commandText.value);
                if ((string[0] == '$') && hasAlphaNumPunc(string) && (string.length > 2)) {
                    commandText.style.color = "blue";
                } else {
                    commandText.style.color = "red";
                }
            }

            if (g_stillConnected == 0) {
                setOverlay("Disconnected");
            }

            var freq1 = document.getElementById("freq1Text");

            if (freq1) {
                if ((g_freq1FrequencyHz < 3510000) || (g_freq1FrequencyHz > 3600000)) {
                    freq1.style.color = "red";
                } else {
                    freq1.style.color = "blue";
                }
            }

            var fTime = document.getElementById("xmtrTime");

            if (fTime.innerHTML.indexOf("Disconnected") !== -1) {
                fTime.style.color = "red";
            } else {
                fTime.style.color = "black";
            }
        }

        function pad(num, size) {
            var s = "000000000" + num;
            return s.substr(s.length - size);
        }

        ////////////////////////////////////////////////////////////

        function updateFreqButtonText() {
            var freqButton = document.getElementById("frequencyButton");

            freqButton.value = freqDotFormat(g_freq1FrequencyHz);
        }

        function updatePowerLevels() {
            var powerSelect = document.getElementById("pwrSelect");

            if (powerSelect != null) {
                powerSelect.options.length = 0;
                var option, i, il;
                i = 0;
                il = g_powerLevels_80m.length;

                for (i = 0; i < il; i += 1) {
                    option = document.createElement('option');
                    option.setAttribute('value', g_powerLevels_80m[i]);
                    option.appendChild(document.createTextNode(g_powerLevels_80m[i]));
                    if (g_powerLevels_80m[i] == g_powerLevel) {
                        option.setAttribute("selected", "true");
                    }

                    powerSelect.appendChild(option);
                }
            }
        }

        function freq1Change() {
            var freq = document.querySelector("#freq1");
            var count = document.querySelector(".freq1val");
            var f = Math.floor(freq.value);

            if (f > 0) {
                count.textContent = "\xa0\xa0>\xa0\xa0\xa0>>\xa0\xa0\xa0>>>";
            } else if (f < 0) {
                count.textContent = "<<<\xa0\xa0\xa0<<\xa0\xa0\xa0<\xa0\xa0";
            } else {
                count.textContent = "<<<\xa0\xa0\xa0<<\xa0\xa0\xa0<\xa0\xa0\xa0>\xa0\xa0\xa0>>\xa0\xa0\xa0>>>";
            }

            if (g_timer != 0) {
                clearInterval(g_timer);
                g_timer = 0;
            }

            if (f != 0) {
                if (f < 0) f = -f;
                var time = 500 - (5 * f);
                g_timer = setInterval(function() {
                    incFreq1();
                }, time);
            }
        }

        ////////////////////////////////////////////////////////////

        function incFreq1Click() {
            var val = g_freq1FrequencyHz + 100;

            g_freq1FrequencyHz = clamp(Number("3500000"), val, Number("4000000"));
            updateFreqButtonText();
            freq1String(val)
            sendFreq(val);
        }

        ////////////////////////////////////////////////////////////

        function decFreq1Click() {
            var val = Number(g_freq1FrequencyHz) - 100;

            g_freq1FrequencyHz = clamp(Number("3500000"), val, Number("4000000"));
            updateFreqButtonText();
            freq1String(val)
            sendFreq(val);
        }

        ////////////////////////////////////////////////////////////

        function incFreq1() {
            var ftext = document.getElementById("freq1Text");
            var freq = document.querySelector("#freq1");
            var f = Math.floor(Number(freq.value));
            var val;

            if (f != 0) {
                if (f < 0) {
                    val = g_freq1FrequencyHz - 100;
                } else {
                    val = g_freq1FrequencyHz + 100;
                }

                val = clamp(Number("3500000"), val, Number("4000000"));
                updateFreqButtonText();
                freq1String(val);
            } else {
                clearTimeout(g_timer);
                g_timer = 0;
            }
        }

        ////////////////////////////////////////////////////////////

        function resetFreq1Slider() {
            var freq = document.querySelector("#freq1");
            var count = document.querySelector(".freq1val");

            freq.value = 0;
            count.textContent = "<<<\xa0\xa0\xa0<<\xa0\xa0\xa0<\xa0\xa0\xa0>\xa0\xa0\xa0>>\xa0\xa0\xa0>>>";
            sendFreq(g_freq1FrequencyHz, 4);
        }

        ////////////////////////////////////////////////////////////

        function freq1String(myString) {
            var f = document.getElementById("freq1Text");
            g_freq1FrequencyHz = Number(myString);
            if (f) f.value = freqDotFormat(myString);
        }

        function freqDotFormat(freqString) {
            var val = Number(freqString);
            var newString = String(Math.floor(val / 1000000)) + "." + pad(Math.floor(((val % 1000000) / 1000)), 3) + "." + pad((val % 1000), 3);
            return newString;
        }

        ////////////////////////////////////////////////////////////

        function toggleFreqSettings() {
            var x1 = document.getElementById("freqSet1");

            if (x1.style.display == "block") {
                hideFreqSettings();
            } else {
                showFreqSettings();
            }
        }

        function showFreqSettings() {

            showFreqSet1();

            freqStr = String(g_freq1FrequencyHz);
            freq1String(freqStr);
            document.getElementById("freqSet1Heading").innerHTML = "Set Frequency";
        }

        function hideFreqSettings() {
            hideFreqSet1();
        }

        ////////////////////////////////////////////////////////////

        function showFreqSet1() {
            var x = document.getElementById("freqSet1");
            x.style.display = "block";

        }

        function hideFreqSet1() {
            var x = document.getElementById("freqSet1");
            x.style.display = "none";
        }

        ////////////////////////////////////////////////////////////

        window.addEventListener("mouseup", function() {
            if (document.getElementById("freq1").value != 0) {
                resetFreq1Slider();
            }
        });

        window.addEventListener("touchend", function() {
            if (document.getElementById("freq1").value != 0) {
                resetFreq1Slider();
            }
        });

        window.addEventListener("click", function() {
            if (document.getElementById("freq1").value != 0) {
                resetFreq1Slider();
            }
        });

        ////////////////////////////////////////////////////////////

        function escapeString(str) {
            var needsEscape = /^[,!?$\\]*$/;
            var len = str.length;
            var newString = "";

            for (let i = 0; i < len; i++) {
                if (str[i].match(needsEscape)) {
                    newString = newString + '\\' + str[i];
                } else {
                    newString = newString + str[i];
                }
            }
            return newString;
        }

        function sendCookieValuesToRadio() {
            setTimeout(function() {
                let msgText = "PASS,$KEY,^;";
                sendToSocket(msgText);
            }, 6000);

            setTimeout(sendPower, 4000);

            setTimeout(sendCodeSpeed, 4250);

            setTimeout(function() {
                let msgText = "FREQ,0," + String(g_freq1FrequencyHz);
                sendToSocket(msgText);
            }, 4500);
        }

        function sendString1Click() {
            var text = document.getElementById("user1Text").value;
            var btext = "PASS,$KEY," + escapeString(text) + ";";
            sendToSocket(btext);
        }

        function sendString2Click() {
            var text = document.getElementById("user2Text").value;
            var btext = "PASS,$KEY," + escapeString(text) + ";";
            sendToSocket(btext);
        }

        function sendString3Click() {
            var text = document.getElementById("user3Text").value;
            var btext = "PASS,$KEY," + escapeString(text) + ";";
            sendToSocket(btext);
        }

        function sendString4Click() {
            var text = document.getElementById("user4Text").value;
            var btext = "PASS,$KEY," + escapeString(text) + ";";
            sendToSocket(btext);
        }

        function sendString5Click() {
            var text = document.getElementById("user5Text").value;
            var btext = "PASS,$KEY," + escapeString(text) + ";";
            sendToSocket(btext);
        }

    </script>


    <div id="overlay">
        <div id="overlayText">Connecting...</div>
    </div>

    <center>
        <p style="text-align:left;"><a href=\ "73.73.73.73">[HOME]</a></p>
        <h1 id="mainHeading" style="font-family:verdana; font-size:30px; color:Black; text-align:center;">Transmitter Test</h1>
        <p id="wifiVersion" style="font-family:verdana; font-size:12px; color:Black; text-align:center;"></p>
        <p id="ATMEGAVersion" style="font-family:verdana; font-size:12px; color:Black; text-align:center;"></p>
        <p id="version" style="font-family:verdana; font-size:12px; color:Black; text-align:center;">test.html Version: 0.81 - 30 May 2022</p>

        <div>
            <table>
                <tr>
                    <td style="width:200px; height:50px; text-align:right; vertical-align:middle;">
                        <p id="batteryLevel" style="font-family:verdana; font-size:15px; color:Black; font-weight:bold; text-align:center;">Battery: ?</p>
                    </td>
                    <td style="width:200px; height:50px; text-align:right; vertical-align:middle;">
                        <p id="temperature" style="font-family:verdana; font-size:15px; color:Black; font-weight:bold; text-align:center;">Temp: ?</p>
                    </td>
                </tr>
            </table>

            <table>
                <tr>
                    <td style="text-align:right;">
                        <p id="xmtrTime" style="font-family:verdana; font-size:20px; color:Red; font-weight:bold; text-align:center;">Disconnected</p>
                    </td>
                </tr>
            </table>

            <table>
                <tr>
                    <td style="text-align:right;">
                        <p id="currentTime" style="font-family:verdana; font-size:20px; color:Black; font-weight:bold; text-align:center;">Updating...</p>
                    </td>
                </tr>
            </table>

            <table>
                <tr>
                    <td style="text-align:left; vertical-align:center;">
                        <button id="SyncButton" class="incbutton" onclick="syncClock();">Sync</button>
                    </td>
                </tr>
            </table>

            <table>
                <tr>
                    <td style="text-align:right;">
                        <p id="errorreport" style="display:none;"></p>
                    </td>
                </tr>
            </table>

            <table>
                <tr>
                    <td style="text-align:right;">
                        <p id="statusreport" style="display:none;"></p>
                    </td>
                </tr>
            </table>

            <table border="1" id="eventTable"></table>

            <h4 id="userStringsHeading" style="font-family:verdana; font-size:18px; font-weight:bold; text-align:center">User Defined Strings</h4>
            <table>
                <table>
                    <tr>
                        <td>
                            <input type="text" style="font-family:verdana; font-size:20px; font-weight:bold; text-align:center" id="user1Text" name="user1Text" value=" " onchange="setCookie(2 * 365, 'ut1', value);" />
                        </td>

                        <td style="width:14.4px; text-align: left">
                            <button id="sendUserText1" class="button" onclick="sendString1Click();">SEND</button>
                        </td>

                    </tr>
                    <tr>
                        <td>
                            <input type="text" style="font-family:verdana; font-size:20px; font-weight:bold; text-align:center" id="user2Text" name="user2Text" value=" " onchange="setCookie(2 * 365, 'ut2', value);" />
                        </td>

                        <td style="width:14.4px; text-align: left">
                            <button id="sendUserText2" class="button" onclick="sendString2Click();">SEND</button>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="text" style="font-family:verdana; font-size:20px; font-weight:bold; text-align:center" id="user3Text" name="user3Text" value=" " onchange="setCookie(2 * 365, 'ut3', value);" />
                        </td>

                        <td style="width:14.4px; text-align: left">
                            <button id="sendUserText3" class="button" onclick="sendString3Click();">SEND</button>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="text" style="font-family:verdana; font-size:20px; font-weight:bold; text-align:center" id="user4Text" name="user4Text" value=" " onchange="setCookie(2 * 365, 'ut4', value);" />
                        </td>

                        <td style="width:14.4px; text-align: left">
                            <button id="sendUserText4" class="button" onclick="sendString4Click();">SEND</button>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="text" style="font-family:verdana; font-size:20px; font-weight:bold; text-align:center" id="user5Text" name="user5Text" value=" " onchange="setCookie(2 * 365, 'ut5', value);" />
                        </td>

                        <td style="width:14.4px; text-align: left">
                            <button id="sendUserText5" class="button" onclick="sendString5Click();">SEND</button>
                        </td>
                    </tr>
                </table>
            </table>

            <div id="freqSet1" style="display:none;">
                <h4 id="freqSet1Heading" style="font-family:verdana; font-size:20px; font-weight:bold; text-align:center">Fox Frequency</h4>

                <table>
                    <tr>
                        <td>
                            <button id="FreqDownButton" class="decbutton" onclick="decFreq1Click();">DEC</button>
                        </td>

                        <td>
                            <input type="text" style="font-family:verdana; font-size:20px; font-weight:bold; text-align:center" id="freq1Text" name="freq1Text" value="" readonly="readonly" />
                        </td>

                        <td style="width:14.4px; text-align: left">
                            <button id="FreqUpButton" class="incbutton" onclick="incFreq1Click();">INC</button>
                        </td>
                    </tr>
                </table>

                <div>
                    <span class="freq1val" style="text-align:center; color:black"></span>

                    <table>
                        <tr>
                            <td></td>

                            <td style="width:400px; text-align:center">
                                <input style="font-family:verdana; font-size:20px; width:400px; text-align:center; color:black; font-weight:bold;" type="range" name="freq1" id="freq1" min="-100" max="100" step="1" value="0" oninput="freq1Change();" />
                            </td>
                        </tr>
                    </table>
                </div>

            </div>
        </div>

        <h3 id="macAddress" style="font-family:verdana; font-size:15px; font-weight:bold; text-align:center">Waiting for MAC Address</h3>
    </center>
</body>

</html>
